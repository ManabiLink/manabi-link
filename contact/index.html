<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ãã‚…ã‚‹ã‚“â™¡ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆDiscordï¼‹Firebaseï¼‰</title>
<style>
body {
  margin:0;
  font-family:"Zen Maru Gothic","Noto Sans JP",sans-serif;
  background: linear-gradient(180deg,#ffeaf5,#fff5f8,#fff);
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}
.container {
  background: rgba(255,255,255,0.95);
  border-radius:25px;
  padding:40px 50px;
  width:90%;
  max-width:520px;
  box-shadow:0 8px 30px rgba(255,150,180,0.25);
}
h1{color:#ff69b4;text-align:center;margin-bottom:15px;}
.form-group{margin-bottom:15px;}
label{display:block;font-weight:bold;color:#ff5fa0;margin-bottom:5px;}
input,textarea,select{
  width:100%;padding:10px;border-radius:12px;border:2px solid #ffd6e8;font-size:1rem;transition:0.2s;
}
input:focus,textarea:focus,select:focus{border-color:#ff8ac7;outline:none;}
textarea{height:100px;resize:none;}
button{
  background:linear-gradient(180deg,#ffb7e2,#ff7ecf);
  color:white;font-weight:bold;padding:12px;border:none;border-radius:20px;width:100%;font-size:1.1rem;cursor:pointer;
}
button:hover{transform:scale(1.05);}
#feedback{margin-top:10px;text-align:center;min-height:20px;font-weight:bold;color:#ff69b4;}
</style>
</head>
<body>
<div class="container">
  <h1>ãã‚…ã‚‹ã‚“â™¡ãŠå•ã„åˆã‚ã›</h1>
  <form id="form">
    <div class="form-group">
      <label for="title">ã‚¿ã‚¤ãƒˆãƒ«</label>
      <input type="text" id="title" required placeholder="ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦ã­â™¡">
    </div>
    <div class="form-group">
      <label for="kind">ç¨®åˆ¥</label>
      <select id="kind" required>
        <option value="">é¸æŠã—ã¦ã­â™¡</option>
        <option value="è³ªå•">ğŸ’¬ è³ªå•</option>
        <option value="è¦æœ›">ğŸŒˆ è¦æœ›</option>
        <option value="ä¸å…·åˆå ±å‘Š">ğŸ ä¸å…·åˆå ±å‘Š</option>
        <option value="ãã®ä»–">ğŸ€ ãã®ä»–</option>
      </select>
    </div>
    <div class="form-group">
      <label for="content">æœ¬æ–‡</label>
      <textarea id="content" required placeholder="æœ¬æ–‡ã‚’å…¥åŠ›ã—ã¦ã­â™¡"></textarea>
    </div>
    <div class="form-group">
      <label for="email">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
      <input type="email" id="email" required placeholder="example@mail.com">
    </div>
    <div class="form-group">
      <label for="name">åå‰ï¼ˆä»»æ„ï¼‰</label>
      <input type="text" id="name" placeholder="åŒ¿åã§ã‚‚OKâ™¡">
    </div>
    <button type="submit">ğŸ’Œ é€ä¿¡ã™ã‚‹</button>
    <p id="feedback"></p>
  </form>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-auth-compat.js"></script>

<script>
  // ğŸ”‘ Firebaseè¨­å®š
  const firebaseConfig = {
    apiKey: "API_KEY",
    authDomain: "PROJECT_ID.firebaseapp.com",
    projectId: "PROJECT_ID",
    storageBucket: "PROJECT_ID.appspot.com",
    messagingSenderId: "SENDER_ID",
    appId: "APP_ID"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const auth = firebase.auth();

  // èªè¨¼çŠ¶æ…‹ã®ç›£è¦–
  auth.onAuthStateChanged((user) => {
    if (user) {
      console.log('ãƒ­ã‚°ã‚¤ãƒ³ä¸­:', user.email);
      document.querySelectorAll('.auth-required').forEach(el => el.style.display = 'block');
      document.querySelectorAll('.auth-anonymous').forEach(el => el.style.display = 'none');
    } else {
      console.log('æœªãƒ­ã‚°ã‚¤ãƒ³');
      document.querySelectorAll('.auth-required').forEach(el => el.style.display = 'none');
      document.querySelectorAll('.auth-anonymous').forEach(el => el.style.display = 'block');
    }
  });

  const form = document.getElementById('form');
  const feedback = document.getElementById('feedback');

  // ğŸ”” Discord Webhook URL
  const webhookURL = "https://discordapp.com/api/webhooks/1433692231688257638/oxlgPYE7yzSLqJk69zorMCHch6wEtty1CMcT9kM6348bAi-vwwaKsiConXhmKxGZQkn1";

  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    feedback.textContent="";

    const data = {
      title: document.getElementById('title').value,
      kind: document.getElementById('kind').value,
      content: document.getElementById('content').value,
      email: document.getElementById('email').value,
      name: document.getElementById('name').value || "åŒ¿å",
      timestamp: new Date()
    
    };

    // ã‚µãƒ¼ãƒãƒ¼å´ï¼ˆCloud Functionç­‰ï¼‰ã¸é€ä¿¡ã—ã¦
    // 1) Firestore ã«ä¿å­˜
    // 2) Discord webhook ã«è»¢é€ ã‚’ã‚µãƒ¼ãƒãƒ¼å´ã§è¡Œã†ãƒ•ãƒ­ãƒ¼ã«ã™ã‚‹
    // ï¼ˆCORSã‚„ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆç®¡ç†ã®ãŸã‚æ¨å¥¨ï¼‰
    const relayURL = "https://us-central1-YOUR_PROJECT.cloudfunctions.net/sendContact"; // ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã«ç½®ãæ›ãˆã¦ãã ã•ã„

    try{
      const res = await fetch(relayURL, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(data)
      });
      if(res.ok){
        feedback.style.color = "#ff69b4";
        feedback.textContent = "â™¡ é€ä¿¡å®Œäº†ï¼Firebaseï¼†Discordã«å±Šã„ãŸã‚ˆ â™¡";
        form.reset();
      }else{
        const text = await res.text();
        console.error('relay error', res.status, text);
        feedback.style.color = "#e33";
        feedback.textContent = "ã‚µãƒ¼ãƒãƒ¼çµŒç”±ã§ã®é€šçŸ¥ã«å¤±æ•—ã—ã¾ã—ãŸğŸ’¦";
      }
    }catch(err){
      feedback.style.color = "#e33";
      feedback.textContent = "é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸğŸ’¦";
      console.error(err);
    }
  });
</script>
</body>
</html>
