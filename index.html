<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ManabiLink — ボタンで操作</title>
    <link rel="stylesheet" href="index.css">
</head>

<body class="font-medium">
    <header class="site-header">
        <div class="container">
            <h1 class="logo">ManabiLink</h1>
            <nav class="nav">
                <button onclick="location.href='feature/'" style="margin-left: 0;">特徴</button>
                <button onclick="location.href='servce/'">サービスについて</button>
                <button onclick="alert('お問い合わせフォームへ遷移（準備中）')">お問い合わせ</button>
            </nav>
            <div class="hamburger" onclick="toggleMenu()">
                <span></span><span></span><span></span>
            </div>
        </div>
    </header>

    <div id="menuBackdrop" class="menu-backdrop" onclick="toggleMenu()"></div>
    <div id="menuOverlay" class="menu-overlay">
        <div class="menu-close" onclick="toggleMenu()">×</div>
        <ul class="menu-items">
            <li onclick="location.href='carender/'; toggleMenu()">子供の成長記録</li>
            <li onclick="location.href='learnig/'; toggleMenu()">読み聞かせページ</li>
            <!-- <li onclick="alert('おとぎ話を読む（準備中）'); toggleMenu()">おとぎ話を読む</li> -->
            <li onclick="location.href='setting/'; toggleMenu()">設定</li>
            <li onclick="handleLogout(); toggleMenu()">ログアウト</li>
        </ul>
    </div>

    <main>
        <div id="home" class="container-box home page active">
            <h2>まなびリンクプロジェクト</h2>
            <div class="button-area">
                <a class="home-btn guardian-btn" href="login/">保護者の方はこちら</a>
                <a class="home-btn expert-btn" href="login/">専門家の方はこちら</a>
            </div>
        </div>

        <div id="dashboard" class="container-box dashboard page">
            <h2>ダッシュボード</h2>
            <div class="welcome-text"><span id="userName"></span>さん、ようこそ!</div>
            <div class="dashboard-content">
                <div class="card" onclick="location.href='communication/'">
                    <div class="card-icon">👥</div>
                    <h3>保護者同士のコミュニケーション</h3>
                </div>
                <div class="card">
                    <div class="card-icon">📰</div>
                    <h3>保護者の方にお勧めの記事</h3>
                    <div class="card-buttons">
                        <button class="card-btn" onclick="alert('記事1（準備中）')">記事1</button>
                        <button class="card-btn" onclick="alert('記事2（準備中）')">記事2</button>
                    </div>
                </div>
                <div class="card">
                    <div class="card-icon">💬</div>
                    <h3>専門家との話し合い</h3>
                    <div class="card-buttons">
                        <button class="card-btn" onclick="alert('就労について（準備中）')">就労について</button>
                        <button class="card-btn" onclick="alert('放課後デイについて（準備中）')">放課後等デイサービスについて</button>
                    </div>
                </div>
            </div>
            <div style="text-align: center;">
                <button class="btn logout-btn" onclick="handleLogout()">ログアウト</button>
            </div>
        </div>
    </main>

    <footer class="site-footer">
        <div class="container">
            <small>&copy; 2025 ManabiLink</small>
        </div>
    </footer>

    <script src="index.js"></script>
    <script type="module">
        // Initialize Firebase by fetching generated /config.json
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-analytics.js";
        import {
            getAuth,
            onAuthStateChanged,
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            signOut,
            updatePassword,
            updateEmail,
            sendPasswordResetEmail,
            updateProfile
        } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";

        async function initFirebase() {
            try {
                const res = await fetch('/config.json');
                if (!res.ok) throw new Error('config.json not found');
                const firebaseConfig = await res.json();
                const app = initializeApp(firebaseConfig);
                try { getAnalytics(app); } catch (e) { /* analytics optional */ }

                const auth = getAuth(app);
                // expose to non-module script
                window.firebaseAuth = auth;
                window.firebaseAPI = {
                    createUserWithEmailAndPassword,
                    signInWithEmailAndPassword,
                    signOut,
                    updatePassword,
                    updateEmail,
                    sendPasswordResetEmail,
                    onAuthStateChanged,
                    updateProfile
                };

                // 通知用イベント
                onAuthStateChanged(auth, user => {
                    window.dispatchEvent(new CustomEvent('firebaseAuthChanged', { detail: user }));
                });
            } catch (e) {
                console.warn('Firebase not initialized:', e.message);
            }
        }

        initFirebase();
    </script>
</body>

</html>