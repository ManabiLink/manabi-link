<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ã‚‚ã˜ã®ãŠã‘ã„ã“</title>
<style>
  body {
    font-family: 'Arial', 'Hiragino Kaku Gothic Pro', 'Meiryo', sans-serif;
    background: linear-gradient(135deg, #ffc3e1 0%, #ff9ec9 100%);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .container {
    background: white;
    border-radius: 30px;
    padding: 40px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    width: 90%;
    max-width: 800px;
    text-align: center;
  }
  h1 {
    color: #667eea;
    font-size: 2.5em;
    margin-bottom: 30px;
  }
  .selection-buttons, .dan-buttons, .action-buttons, .nav-buttons {
    display: flex;
    gap: 15px;
    justify-content: center;
    flex-wrap: wrap;
    margin: 20px 0;
  }
  .select-btn, .dan-btn, .action-btn, .nav-btn {
    padding: 15px 30px;
    border: none;
    border-radius: 15px;
    font-size: 1.3em;
    cursor: pointer;
    font-weight: bold;
    color: white;
    transition: 0.3s;
  }
  .select-btn.hiragana { background: #f093fb; }
  .select-btn.katakana { background: #4facfe; }
  .select-btn.alphabet { background: #43e97b; }
  .dan-btn { background: #667eea; }
  .action-btn { background: #fa709a; }
  .read-btn { background: #30cfd0; }
  .nav-btn { background: #667eea; }
  .select-btn:hover, .dan-btn:hover, .action-btn:hover, .nav-btn:hover {
    transform: scale(1.05);
  }
  .display-area {
    background: #f8f9fa;
    border-radius: 20px;
    padding: 40px;
    margin-top: 20px;
  }
  canvas {
    border: 3px dashed #667eea;
    border-radius: 15px;
    background: white;
    touch-action: none;
  }
</style>
</head>
<body>
<div class="container">
  <h1>ğŸŒˆ ã‚‚ã˜ã® ãŠã‘ã„ã“ ğŸŒˆ</h1>

  <!-- ç¨®é¡é¸æŠ -->
  <div class="selection-buttons">
    <button class="select-btn hiragana" onclick="selectType('hiragana')">ã²ã‚‰ãŒãª</button>
    <button class="select-btn katakana" onclick="selectType('katakana')">ã‚«ã‚¿ã‚«ãƒŠ</button>
    <button class="select-btn alphabet" onclick="selectType('alphabet')">ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆ</button>
  </div>

  <!-- æ®µãƒœã‚¿ãƒ³ -->
  <div class="dan-buttons" id="danButtons" style="display: none;"></div>

  <!-- è¡¨ç¤ºé ˜åŸŸ -->
  <div class="display-area" id="displayArea">
    <div style="color:#999;font-size:1.5em;">ä¸Šã®ãƒœã‚¿ãƒ³ã‚’ ãŠã—ã¦ã­ï¼</div>
  </div>

  <!-- æ“ä½œãƒœã‚¿ãƒ³ -->
  <div class="action-buttons" id="actionButtons" style="display:none;">
    <button class="action-btn" onclick="startTracing()">ğŸ”„ ã‚‚ã†ã„ã¡ã©</button>
    <button class="action-btn read-btn" onclick="readAloud()">ğŸ”Š ã‚ˆã¿ãã‹ã›</button>
  </div>

  <div class="nav-buttons" id="navButtons" style="display:none;">
    <button class="nav-btn" onclick="prevChar()">â¬…ï¸ ã¾ãˆ</button>
    <button class="nav-btn" onclick="nextChar()">ã¤ã â¡ï¸</button>
  </div>
</div>

<script>
  const hiraganaRows = {
    ã‚æ®µ: ['ã‚','ã„','ã†','ãˆ','ãŠ'],
    ã‹æ®µ: ['ã‹','ã','ã','ã‘','ã“'],
    ã•æ®µ: ['ã•','ã—','ã™','ã›','ã'],
    ãŸæ®µ: ['ãŸ','ã¡','ã¤','ã¦','ã¨'],
    ãªæ®µ: ['ãª','ã«','ã¬','ã­','ã®'],
    ã¯æ®µ: ['ã¯','ã²','ãµ','ã¸','ã»'],
    ã¾æ®µ: ['ã¾','ã¿','ã‚€','ã‚','ã‚‚'],
    ã‚„æ®µ: ['ã‚„','ã‚†','ã‚ˆ'],
    ã‚‰æ®µ: ['ã‚‰','ã‚Š','ã‚‹','ã‚Œ','ã‚'],
    ã‚æ®µ: ['ã‚','ã‚’','ã‚“']
  };

  const katakanaRows = {
    ã‚¢æ®µ: ['ã‚¢','ã‚¤','ã‚¦','ã‚¨','ã‚ª'],
    ã‚«æ®µ: ['ã‚«','ã‚­','ã‚¯','ã‚±','ã‚³'],
    ã‚µæ®µ: ['ã‚µ','ã‚·','ã‚¹','ã‚»','ã‚½'],
    ã‚¿æ®µ: ['ã‚¿','ãƒ','ãƒ„','ãƒ†','ãƒˆ'],
    ãƒŠæ®µ: ['ãƒŠ','ãƒ‹','ãƒŒ','ãƒ','ãƒ'],
    ãƒæ®µ: ['ãƒ','ãƒ’','ãƒ•','ãƒ˜','ãƒ›'],
    ãƒæ®µ: ['ãƒ','ãƒŸ','ãƒ ','ãƒ¡','ãƒ¢'],
    ãƒ¤æ®µ: ['ãƒ¤','ãƒ¦','ãƒ¨'],
    ãƒ©æ®µ: ['ãƒ©','ãƒª','ãƒ«','ãƒ¬','ãƒ­'],
    ãƒ¯æ®µ: ['ãƒ¯','ãƒ²','ãƒ³']
  };

  const alphabetGroups = {
    ABC: ['A','B','C','D','E'],
    FGH: ['F','G','H','I','J'],
    KLM: ['K','L','M','N','O'],
    PQRS: ['P','Q','R','S','T'],
    TUVWXYZ: ['U','V','W','X','Y','Z']
  };

  let currentType = null;
  let currentGroup = [];
  let currentIndex = 0;
  let ctx, canvas;
  let history = [];

  function selectType(type) {
    currentType = type;
    const danButtons = document.getElementById("danButtons");
    danButtons.innerHTML = "";

    const data = type === 'hiragana' ? hiraganaRows :
                 type === 'katakana' ? katakanaRows : alphabetGroups;

    for (let key in data) {
      const btn = document.createElement("button");
      btn.className = "dan-btn";
      btn.textContent = key;
      btn.onclick = () => selectDan(key);
      danButtons.appendChild(btn);
    }

    danButtons.style.display = "flex";
    document.getElementById('displayArea').innerHTML =
      `<div style="color:#999;font-size:1.5em;">${type === 'alphabet' ? 'ã‚°ãƒ«ãƒ¼ãƒ—ã‚’é¸ã‚“ã§ã­ï¼' : 'æ®µã‚’é¸ã‚“ã§ã­ï¼'}</div>`;

    document.querySelectorAll('.select-btn').forEach(btn => btn.classList.remove('active'));
    document.querySelector(`.select-btn.${type}`).classList.add('active');
  }

  function selectDan(key) {
    const data = currentType === 'hiragana' ? hiraganaRows :
                 currentType === 'katakana' ? katakanaRows : alphabetGroups;
    currentGroup = data[key];
    currentIndex = 0;
    displayCharacter();
    document.getElementById('actionButtons').style.display = 'flex';
    document.getElementById('navButtons').style.display = 'flex';
  }

  function displayCharacter() {
    const char = currentGroup[currentIndex];
    const displayArea = document.getElementById("displayArea");
    displayArea.innerHTML = `
      <canvas id="traceCanvas" width="400" height="400"></canvas>
      <div style="margin-top:15px;">
        <button onclick="undo()" style="padding:10px 20px;border:none;border-radius:10px;background:#667eea;color:white;font-weight:bold;cursor:pointer;">â†©ï¸ æˆ»ã‚‹</button>
      </div>
    `;
    setupCanvas(char);
  }

  function setupCanvas(char) {
    canvas = document.getElementById('traceCanvas');
    ctx = canvas.getContext('2d');
    ctx.fillStyle = '#f0f0f0';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.font = 'bold 250px Arial';
    ctx.fillStyle = '#ddd';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(char, canvas.width/2, canvas.height/2);
    history = [];
    saveHistory();

    let drawing = false;

    // ãƒã‚¦ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆ
    canvas.addEventListener('mousedown', (e) => { 
      drawing = true; 
      saveHistory(); 
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      ctx.beginPath();
      ctx.moveTo(x, y);
    });
    
    canvas.addEventListener('mouseup', () => { 
      drawing = false;
      ctx.beginPath(); // ãƒ‘ã‚¹ã‚’ãƒªã‚»ãƒƒãƒˆ
    });
    
    canvas.addEventListener('mousemove', (e) => { 
      if(drawing) draw(e); 
    });

    // ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆ
    canvas.addEventListener('touchstart', (e) => { 
      e.preventDefault();
      drawing = true; 
      saveHistory(); 
      const rect = canvas.getBoundingClientRect();
      const x = e.touches[0].clientX - rect.left;
      const y = e.touches[0].clientY - rect.top;
      ctx.beginPath();
      ctx.moveTo(x, y);
    });
    
    canvas.addEventListener('touchend', (e) => { 
      e.preventDefault();
      drawing = false;
      ctx.beginPath(); // ãƒ‘ã‚¹ã‚’ãƒªã‚»ãƒƒãƒˆ
    });
    
    canvas.addEventListener('touchmove', (e) => { 
      e.preventDefault();
      if(drawing) draw(e.touches[0]); 
    });
  }

  function draw(e) {
    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    ctx.lineWidth = 15;
    ctx.lineCap = 'round';
    ctx.strokeStyle = '#667eea';
    ctx.lineTo(x, y);
    ctx.stroke();
  }

  function saveHistory() {
    history.push(ctx.getImageData(0,0,canvas.width,canvas.height));
    if(history.length > 50) history.shift();
  }

  function undo() {
    document.getElementById('danButtons').style.display = 'none';
    document.getElementById('actionButtons').style.display = 'none';
    document.getElementById('navButtons').style.display = 'none';
    currentType = null;
    currentGroup = [];
    currentIndex = 0;
    document.getElementById('displayArea').innerHTML =
      `<div style="color:#999;font-size:1.5em;">ä¸Šã®ãƒœã‚¿ãƒ³ã‚’ ãŠã—ã¦ã­ï¼</div>`;
    document.getElementById('danButtons').innerHTML = '';
    document.querySelectorAll('.select-btn').forEach(btn => btn.classList.remove('active'));
  }

  function startTracing() {
    displayCharacter();
  }

  function readAloud() {
    const char = currentGroup[currentIndex];
    const utterance = new SpeechSynthesisUtterance(char);
    utterance.lang = currentType === 'alphabet' ? 'en-US' : 'ja-JP';
    utterance.rate = 0.8;
    speechSynthesis.speak(utterance);
  }

  function nextChar() {
    currentIndex = (currentIndex + 1) % currentGroup.length;
    displayCharacter();
  }

  function prevChar() {
    currentIndex = (currentIndex - 1 + currentGroup.length) % currentGroup.length;
    displayCharacter();
  }
</script>
</body>
</html>