<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ãƒ•ãƒ«ãƒ”ãƒ³ã‚¯ & ãŠè–¬æ‰‹å¸³ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼åˆ‡æ›¿ï¼ˆå¤§ãã‚ï¼‰</title>
<style>
body {
  font-family: system-ui, sans-serif;
  margin: 20px;
  background: linear-gradient(135deg, #ffe6f8, #ffd6eb);
  color: #330033;
  display: flex;
  justify-content: center;
  flex-direction: column;
  align-items: center;
  gap: 20px;
}
button, select {
  padding: 6px 10px;
  border-radius: 6px;
  border: 1px solid #ff99cc;
  cursor: pointer;
  background: #ff99cc;
  color: #330033;
  transition: 0.2s;
  font-size: 1rem;
}
button:hover { background: #ff66aa; }
.calendar, .medicine-calendar {
  width: 700px;
  padding: 20px;
  border-radius: 12px;
}
.calendar { background: linear-gradient(135deg,#ffe6f8,#ffd6eb); }
.medicine-calendar { background: linear-gradient(135deg,#e0f7ff,#b3ecff); }
.header { display: flex; justify-content: space-between; flex-wrap: wrap; gap: 10px; margin-bottom: 12px; align-items: center; }
.controls, .month-year { display: flex; gap: 8px; align-items: center; font-size: 1rem; }
.weekdays, .days { display: grid; grid-template-columns: repeat(7,1fr); gap:6px; }
.weekday { text-align:center; color:#993366; font-weight:600; font-size:1rem; }
.day { min-height:140px; padding-top:28px; border-radius:8px; border:1px dashed #ff99cc; position:relative; overflow:auto; cursor:pointer; transition:0.3s; background:#fff; font-size:1rem; }
.day.expanded { grid-column:span 2; grid-row:span 2; min-height:250px; z-index:10; transform:scale(1.05); box-shadow:0 4px 12px rgba(255,0,128,0.4); }
.medicine-calendar .day { border-color:#66ccff; }
.medicine-calendar .day.expanded { box-shadow:0 4px 12px rgba(0,128,255,0.4); }
.day .num { position:absolute; top:6px; left:6px; font-weight:700; color:#330033; font-size:1.1rem; }
.day.today { outline:3px solid #ff66aa; }
.event-card { padding:10px 12px; border-radius:6px; margin-top:34px; cursor:pointer; font-size:1rem; }
.calendar .event-card { background:#ff99cc; color:#330033; }
.medicine-calendar .event-card { background:#66ccff; color:#003366; }
.event-card h4, .event-card p { margin:0; }
.event-card h4 { font-size:1.1rem; font-weight:700; }
.event-card p { display:none; }
.event-card button { margin-top:6px; padding:5px 10px; font-size:0.85rem; border:none; border-radius:4px; cursor:pointer; }
.event-card .edit { background:#ff66aa; color:#fff; margin-right:4px; }
.event-card .delete { background:#ff3366; color:#fff; }
.medicine-calendar .event-card .edit { background:#3399ff; color:#fff; }
.medicine-calendar .event-card .delete { background:#0066cc; color:#fff; }
.footer { display:flex; justify-content:space-between; margin-top:12px; font-size:1rem; color:#993366; }
input, textarea { width:100%; margin-top:6px; padding:6px; border-radius:4px; border:1px solid #ff99cc; font-size:1rem; background:#ffe6f0; color:#330033; transition:0.2s; }
.medicine-calendar input, .medicine-calendar textarea { background:#e0f0ff; border:1px solid #66ccff; }
input:focus, textarea:focus { outline:2px solid #ff66aa; background:#ffd6e8; }
.medicine-calendar input:focus, .medicine-calendar textarea:focus { outline:2px solid #3399ff; background:#cceeff; }
</style>
</head>
<body>

<div style="display:flex; gap:10px;">
<button id="showMain">ãƒ•ãƒ«ãƒ”ãƒ³ã‚¯ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</button>
<button id="showMed">ãŠè–¬æ‰‹å¸³</button>
</div>

<main class="calendar" id="mainCalendar">
<div class="header">
<div class="title">ãƒ•ãƒ«ãƒ”ãƒ³ã‚¯ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ ğŸ’–</div>
<div class="controls">
<select id="yearMain"></select>å¹´
<select id="monthMain"></select>æœˆ
<button id="jumpMain">ç§»å‹•</button>
<button id="exportMain">CSV</button>
</div>
</div>
<div class="weekdays">
<div class="weekday">æ—¥</div><div class="weekday">æœˆ</div><div class="weekday">ç«</div><div class="weekday">æ°´</div><div class="weekday">æœ¨</div><div class="weekday">é‡‘</div><div class="weekday">åœŸ</div>
</div>
<div class="days" id="daysMain"></div>
<div class="footer"><div>ã‚¯ãƒªãƒƒã‚¯ã§æ—¥ä»˜æ‹¡å¤§ãƒ»ç·¨é›†ãƒ»å‰Šé™¤</div></div>
</main>

<main class="medicine-calendar" id="medicineCalendar" style="display:none;">
<div class="header">
<div class="title">ãŠè–¬æ‰‹å¸³ ğŸ’Š</div>
<div class="controls">
<select id="yearMed"></select>å¹´
<select id="monthMed"></select>æœˆ
<button id="jumpMed">ç§»å‹•</button>
<button id="exportMed">CSV</button>
</div>
</div>
<div class="weekdays">
<div class="weekday">æ—¥</div><div class="weekday">æœˆ</div><div class="weekday">ç«</div><div class="weekday">æ°´</div><div class="weekday">æœ¨</div><div class="weekday">é‡‘</div><div class="weekday">åœŸ</div>
</div>
<div class="days" id="daysMed"></div>
<div class="footer"><div>ã‚¯ãƒªãƒƒã‚¯ã§è–¬ã®è¨˜éŒ²ãƒ»ç·¨é›†ãƒ»å‰Šé™¤</div></div>
</main>

<script>
// å…±é€šé–¢æ•°
function populateSelectors(yearSelect, monthSelect) {
    const currentYear=new Date().getFullYear();
    for(let y=currentYear-10;y<=currentYear+10;y++){ const opt=document.createElement('option'); opt.value=y; opt.textContent=y; yearSelect.appendChild(opt);}
    for(let m=1;m<=12;m++){ const opt=document.createElement('option'); opt.value=m; opt.textContent=m; monthSelect.appendChild(opt);}
    yearSelect.value=new Date().getFullYear(); monthSelect.value=new Date().getMonth()+1;
}
function formatYMD(date){ return `${date.getFullYear()}-${String(date.getMonth()+1).padStart(2,'0')}-${String(date.getDate()).padStart(2,'0')}`; }

function renderCalendar(daysContainer, yearSelect, monthSelect, eventsKey){
    const viewDate=new Date(yearSelect.value, monthSelect.value-1,1);
    daysContainer.innerHTML='';
    const year=viewDate.getFullYear();
    const month=viewDate.getMonth();
    const firstDay=new Date(year,month,1);
    const lastDay=new Date(year,month+1,0);
    const startDay=firstDay.getDay();
    const prevMonthLast=new Date(year,month,0).getDate();
    let events={};
    try{ events=JSON.parse(localStorage.getItem(eventsKey)||'{}'); }catch{}
    const todayStr=formatYMD(new Date());
    const totalCells=Math.ceil((startDay+lastDay.getDate())/7)*7;

    for(let i=0;i<totalCells;i++){
        const cell=document.createElement('div'); cell.className='day';
        let dayNum=i-startDay+1, cellDate;
        if(i<startDay){ cell.classList.add('inactive'); cellDate=new Date(year,month-1,prevMonthLast-(startDay-1-i));}
        else if(dayNum>lastDay.getDate()){ cell.classList.add('inactive'); cellDate=new Date(year,month+1,dayNum-lastDay.getDate());}
        else{ cellDate=new Date(year,month,dayNum);}
        const ymd=formatYMD(cellDate);
        const num=document.createElement('div'); num.className='num'; num.textContent=cellDate.getDate(); cell.appendChild(num);
        if(ymd===todayStr && !cell.classList.contains('inactive')) cell.classList.add('today');
        if(events[ymd]){ const ev=events[ymd]; const title=document.createElement('h4'); title.textContent=ev.title; cell.appendChild(title); }

        cell.addEventListener('click',()=>{
            if(!cell.classList.contains('expanded')){
                document.querySelectorAll('.day.expanded').forEach(d=>d.classList.remove('expanded'));
                cell.classList.add('expanded');
                let ev=events[ymd]||{title:'',body:''};
                cell.innerHTML=`<div class='num'>${cellDate.getDate()}</div>`;
                const inputTitle=document.createElement('input'); inputTitle.value=ev.title; inputTitle.placeholder='ã‚¿ã‚¤ãƒˆãƒ«';
                const inputBody=document.createElement('textarea'); inputBody.value=ev.body; inputBody.placeholder='æœ¬æ–‡';
                const btnSave=document.createElement('button'); btnSave.textContent='ä¿å­˜'; btnSave.className='edit';
                const btnDel=document.createElement('button'); btnDel.textContent='å‰Šé™¤'; btnDel.className='delete';
                btnSave.onclick=e=>{ e.stopPropagation(); ev.title=inputTitle.value.trim(); ev.body=inputBody.value.trim(); events[ymd]=ev; localStorage.setItem(eventsKey,JSON.stringify(events)); renderCalendar(daysContainer,yearSelect,monthSelect,eventsKey);}
                btnDel.onclick=e=>{ e.stopPropagation(); events[ymd]=null; localStorage.setItem(eventsKey,JSON.stringify(events)); renderCalendar(daysContainer,yearSelect,monthSelect,eventsKey);}
                cell.append(inputTitle,inputBody,btnSave,btnDel);
            }
        });
        daysContainer.appendChild(cell);
    }
}

// åˆæœŸåŒ–
populateSelectors(document.getElementById('yearMain'), document.getElementById('monthMain'));
populateSelectors(document.getElementById('yearMed'), document.getElementById('monthMed'));
renderCalendar(document.getElementById('daysMain'), document.getElementById('yearMain'), document.getElementById('monthMain'),'calendar_full_pink_white_cells_title_only');
renderCalendar(document.getElementById('daysMed'), document.getElementById('yearMed'), document.getElementById('monthMed'),'calendar_medicine');

// CSVãƒœã‚¿ãƒ³
document.getElementById('exportMain').onclick = ()=>{
    const events=JSON.parse(localStorage.getItem('calendar_full_pink_white_cells_title_only')||'{}');
    let csv='æ—¥ä»˜,ã‚¿ã‚¤ãƒˆãƒ«,æœ¬æ–‡\n';
    for(const d in events){ const ev=events[d]; csv+=`"${d}","${ev.title.replace(/"/g,'""')}","${ev.body.replace(/"/g,'""').replace(/\n/g,' ')}"\n`; }
    const blob=new Blob([csv],{type:'text/csv'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='calendar.csv'; a.click();
};
document.getElementById('exportMed').onclick = ()=>{
    const events=JSON.parse(localStorage.getItem('calendar_medicine')||'{}');
    let csv='æ—¥ä»˜,ã‚¿ã‚¤ãƒˆãƒ«,æœ¬æ–‡\n';
    for(const d in events){ const ev=events[d]; csv+=`"${d}","${ev.title.replace(/"/g,'""')}","${ev.body.replace(/"/g,'""').replace(/\n/g,' ')}"\n`; }
    const blob=new Blob([csv],{type:'text/csv'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='medicine_calendar.csv'; a.click();
};

// ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼åˆ‡æ›¿
document.getElementById('showMain').onclick=()=>{ document.getElementById('mainCalendar').style.display='block'; document.getElementById('medicineCalendar').style.display='none'; };
document.getElementById('showMed').onclick=()=>{ document.getElementById('mainCalendar').style.display='none'; document.getElementById('medicineCalendar').style.display='block'; };

// æœˆç§»å‹•ãƒ»ã‚¸ãƒ£ãƒ³ãƒ—
document.getElementById('jumpMain').onclick=()=>{ renderCalendar(document.getElementById('daysMain'), document.getElementById('yearMain'), document.getElementById('monthMain'),'calendar_full_pink_white_cells_title_only'); };
document.getElementById('jumpMed').onclick=()=>{ renderCalendar(document.getElementById('daysMed'), document.getElementById('yearMed'), document.getElementById('monthMed'),'calendar_medicine'); };
</script>

</body>
</html>
