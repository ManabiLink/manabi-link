<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ãƒ”ãƒ³ã‚¯ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ ğŸ’– ï¼† ãŠè–¬æ‰‹å¸³ ğŸ’Š + é€šçŸ¥æ©Ÿèƒ½</title>
<style>
  body {
    font-family: "Helvetica", sans-serif;
    background: linear-gradient(180deg, #fff0f6 0%, #fffdfd 100%);
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  h1 {
    color: #ff69b4;
    margin: 20px;
  }
  .mode-buttons {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
  }
  .mode-buttons button {
    background-color: #ff69b4;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 8px 15px;
    cursor: pointer;
  }
  .mode-buttons button.active {
    background-color: #ff85c1;
  }
  .calendar {
    width: 90%;
    max-width: 900px;
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 0 12px rgba(255,105,180,0.3);
    padding: 20px;
    margin-bottom: 30px;
  }
  .calendar-header {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
  }
  select {
    border: 1px solid #ffb6c1;
    border-radius: 6px;
    padding: 5px 10px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
  }
  th {
    color: #ff69b4;
    padding: 8px 0;
  }
  td {
    width: 14.2%;
    height: 100px;
    border: 1px solid #ffd6e7;
    vertical-align: top;
    text-align: left;
    padding: 5px;
    background-color: white;
    cursor: pointer;
    position: relative;
  }
  td.holiday {
    background-color: #fff0f3;
    color: #ff3366;
  }
  .event {
    background-color: #ffb6c1;
    border-radius: 8px;
    padding: 2px 5px;
    margin-top: 3px;
    font-size: 0.8em;
    color: white;
  }
  #editor {
    margin-top: 20px;
    width: 90%;
    max-width: 900px;
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 0 12px rgba(255,105,180,0.3);
    padding: 20px;
    display: none;
    flex-direction: column;
    gap: 10px;
  }
  textarea {
    height: 80px;
  }
  #saveBtn, #deleteBtn {
    background-color: #ff69b4;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 8px 15px;
    cursor: pointer;
  }
  #deleteBtn {
    background-color: #ccc;
    color: #333;
  }
  input[type="datetime-local"] {
    border: 1px solid #ffd6e7;
    border-radius: 6px;
    padding: 5px;
  }
</style>
</head>
<body>
<h1>ãƒ”ãƒ³ã‚¯ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ ğŸ’–</h1>

<div class="mode-buttons">
  <button id="normalBtn" class="active">ğŸ“… é€šå¸¸ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</button>
  <button id="medBtn">ğŸ’Š ãŠè–¬æ‰‹å¸³</button>
</div>

<div class="calendar">
  <div class="calendar-header">
    <select id="year"></select>
    <select id="month"></select>
  </div>
  <table id="calendarTable">
    <thead>
      <tr><th>æ—¥</th><th>æœˆ</th><th>ç«</th><th>æ°´</th><th>æœ¨</th><th>é‡‘</th><th>åœŸ</th></tr>
    </thead>
    <tbody id="calendarBody"></tbody>
  </table>
</div>

<div id="editor">
  <h3 id="selectedDate"></h3>
  <input type="text" id="titleInput" placeholder="ã‚¿ã‚¤ãƒˆãƒ«">
  <textarea id="bodyInput" placeholder="å†…å®¹"></textarea>
  <label>é€šçŸ¥æ—¥æ™‚ï¼š</label>
  <input type="datetime-local" id="notifyInput">
  <div style="display:flex; gap:10px;">
    <button id="saveBtn">ä¿å­˜</button>
    <button id="deleteBtn">å‰Šé™¤</button>
  </div>
</div>

<script>
const HOLIDAYS = {
  "2025-01-01": "å…ƒæ—¥", "2025-01-13": "æˆäººã®æ—¥", "2025-02-11": "å»ºå›½è¨˜å¿µã®æ—¥",
  "2025-02-23": "å¤©çš‡èª•ç”Ÿæ—¥", "2025-03-20": "æ˜¥åˆ†ã®æ—¥", "2025-04-29": "æ˜­å’Œã®æ—¥",
  "2025-05-03": "æ†²æ³•è¨˜å¿µæ—¥", "2025-05-04": "ã¿ã©ã‚Šã®æ—¥", "2025-05-05": "ã“ã©ã‚‚ã®æ—¥",
  "2025-07-21": "æµ·ã®æ—¥", "2025-08-11": "å±±ã®æ—¥", "2025-09-15": "æ•¬è€ã®æ—¥",
  "2025-09-23": "ç§‹åˆ†ã®æ—¥", "2025-10-13": "ã‚¹ãƒãƒ¼ãƒ„ã®æ—¥", "2025-11-03": "æ–‡åŒ–ã®æ—¥",
  "2025-11-23": "å‹¤åŠ´æ„Ÿè¬ã®æ—¥"
};

let events = JSON.parse(localStorage.getItem("events") || "{}");
let meds = JSON.parse(localStorage.getItem("meds") || "{}");
let selectedDate = null;
let currentMode = "normal";

const calendarBody = document.getElementById("calendarBody");
const yearSelect = document.getElementById("year");
const monthSelect = document.getElementById("month");
const editor = document.getElementById("editor");
const saveBtn = document.getElementById("saveBtn");
const deleteBtn = document.getElementById("deleteBtn");
const normalBtn = document.getElementById("normalBtn");
const medBtn = document.getElementById("medBtn");
const notifyInput = document.getElementById("notifyInput");

function setupSelectors() {
  const now = new Date();
  for (let y = 2020; y <= 2030; y++) {
    const opt = document.createElement("option");
    opt.value = y;
    opt.text = y;
    yearSelect.appendChild(opt);
  }
  for (let m = 1; m <= 12; m++) {
    const opt = document.createElement("option");
    opt.value = m;
    opt.text = m;
    monthSelect.appendChild(opt);
  }
  yearSelect.value = now.getFullYear();
  monthSelect.value = now.getMonth() + 1;
}
setupSelectors();

function renderCalendar() {
  const year = +yearSelect.value;
  const month = +monthSelect.value;
  calendarBody.innerHTML = "";

  const firstDay = new Date(year, month - 1, 1).getDay();
  const daysInMonth = new Date(year, month, 0).getDate();
  let row = document.createElement("tr");

  for (let i = 0; i < firstDay; i++) row.appendChild(document.createElement("td"));

  for (let day = 1; day <= daysInMonth; day++) {
    const cell = document.createElement("td");
    const ymd = `${year}-${String(month).padStart(2,"0")}-${String(day).padStart(2,"0")}`;
    cell.dataset.date = ymd;

    if (currentMode === "normal" && HOLIDAYS[ymd]) {
      cell.classList.add("holiday");
      cell.innerHTML = `<strong>${day}</strong><br><small>${HOLIDAYS[ymd]}</small>`;
    } else {
      cell.textContent = day;
    }

    const dataSet = currentMode === "normal" ? events : meds;
    if (dataSet[ymd]) {
      const ev = document.createElement("div");
      ev.className = "event";
      ev.textContent = dataSet[ymd].title;
      cell.appendChild(ev);
    }

    cell.addEventListener("click", openEditor);
    row.appendChild(cell);

    if ((firstDay + day) % 7 === 0 || day === daysInMonth) {
      calendarBody.appendChild(row);
      row = document.createElement("tr");
    }
  }
}
renderCalendar();
yearSelect.onchange = monthSelect.onchange = renderCalendar;

function openEditor(e) {
  selectedDate = e.currentTarget.dataset.date;
  if (!selectedDate) return;
  editor.style.display = "flex";
  document.getElementById("selectedDate").textContent = selectedDate;
  const dataSet = currentMode === "normal" ? events : meds;
  const data = dataSet[selectedDate] || {};
  document.getElementById("titleInput").value = data.title || "";
  document.getElementById("bodyInput").value = data.body || "";
  notifyInput.value = data.notify || "";
  notifyInput.min = new Date().toISOString().slice(0,16);
}

saveBtn.onclick = () => {
  if (!selectedDate) return;
  const title = document.getElementById("titleInput").value;
  const body = document.getElementById("bodyInput").value;
  const notify = notifyInput.value;
  if (notify && notify < new Date().toISOString().slice(0,16)) {
    alert("é€šçŸ¥æ—¥æ™‚ã¯ç¾åœ¨ä»¥é™ã«è¨­å®šã—ã¦ãã ã•ã„ğŸ’–");
    return;
  }
  const dataSet = currentMode === "normal" ? events : meds;
  dataSet[selectedDate] = { title, body, notify };
  localStorage.setItem(currentMode === "normal" ? "events" : "meds", JSON.stringify(dataSet));
  renderCalendar();
  editor.style.display = "none";
};

deleteBtn.onclick = () => {
  if (!selectedDate) return;
  const dataSet = currentMode === "normal" ? events : meds;
  delete dataSet[selectedDate];
  localStorage.setItem(currentMode === "normal" ? "events" : "meds", JSON.stringify(dataSet));
  renderCalendar();
  editor.style.display = "none";
};

normalBtn.onclick = () => {
  currentMode = "normal";
  normalBtn.classList.add("active");
  medBtn.classList.remove("active");
  renderCalendar();
  editor.style.display = "none";
};

medBtn.onclick = () => {
  currentMode = "med";
  medBtn.classList.add("active");
  normalBtn.classList.remove("active");
  renderCalendar();
  editor.style.display = "none";
};

if ("Notification" in window) {
  Notification.requestPermission().then(p => {
    if (p === "granted") console.log("é€šçŸ¥ãŒè¨±å¯ã•ã‚Œã¾ã—ãŸ");
  });
}

setInterval(() => {
  checkAndNotify(events);
  checkAndNotify(meds);
}, 60000);

function checkAndNotify(dataset) {
  const now = new Date().toISOString().slice(0,16);
  for (const [date, ev] of Object.entries(dataset)) {
    if (ev.notify && ev.notify === now) {
      new Notification(ev.title || "äºˆå®š", { body: ev.body || "é€šçŸ¥ã§ã™ğŸ’–" });
    }
  }
}
</script>
</body>
</html>
