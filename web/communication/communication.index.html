<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ä¿è­·è€…ã®ãŸã‚ã®å®‰å¿ƒæ²ç¤ºæ¿</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', Meiryo, sans-serif;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-pink-50 via-rose-50 to-purple-50 min-h-screen">
  <div class="max-w-4xl mx-auto p-4 md:p-8">

    <!-- Header -->
    <div class="bg-white rounded-2xl shadow-lg p-6 mb-6 border-t-4 border-pink-400">
      <h1 class="text-3xl font-bold text-pink-600 mb-2">ä¿è­·è€…ã®ãŸã‚ã®å®‰å¿ƒæ²ç¤ºæ¿</h1>
      <p class="text-gray-600 flex items-center gap-2">
        <svg class="w-4 h-4 text-pink-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="12"></line>
          <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
        åŒ¿åã§å®‰å¿ƒã—ã¦ç›¸è«‡ãƒ»å…±æœ‰ã§ãã‚‹å ´æ‰€ã§ã™ï¼ˆã™ã¹ã¦ã®æŠ•ç¨¿ã¨è¿”ä¿¡ã¯èª°ã§ã‚‚è¦‹ã‚‰ã‚Œã¾ã™ï¼‰
      </p>
    </div>

    <!-- Post Form -->
    <div class="bg-white rounded-2xl shadow-lg p-6 mb-6 border-t-4 border-pink-300">
      <h2 class="text-xl font-bold text-pink-600 mb-4">æŠ•ç¨¿ã™ã‚‹</h2>

      <div class="mb-4">
        <label class="block text-sm font-medium text-gray-700 mb-2">ã‚«ãƒ†ã‚´ãƒªãƒ¼</label>
        <select id="category" class="w-full p-3 border border-pink-200 rounded-lg focus:ring-2 focus:ring-pink-400 focus:border-transparent">
          <option value="general">æ—¥ã€…ã®æ‚©ã¿</option>
          <option value="health">å¥åº·ãƒ»ç™ºé”</option>
          <option value="education">å­¦ç¿’ãƒ»é€²è·¯</option>
          <option value="relationship">è¦ªå­é–¢ä¿‚</option>
          <option value="lifestyle">ç”Ÿæ´»ãƒ»ç¿’æ…£</option>
        </select>
      </div>

      <div class="mb-4">
        <label class="block text-sm font-medium text-gray-700 mb-2">ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ï¼ˆä»»æ„ï¼‰</label>
        <input id="nickname" type="text" maxlength="20"
          placeholder="ç©ºæ¬„ã®å ´åˆã¯ã€ŒåŒ¿åã®ä¿è­·è€…ã€ã¨è¡¨ç¤ºã•ã‚Œã¾ã™"
          class="w-full p-3 border border-pink-200 rounded-lg focus:ring-2 focus:ring-pink-400 focus:border-transparent" />
      </div>

      <div class="mb-4">
        <label class="block text-sm font-medium text-gray-700 mb-2">ç›¸è«‡ãƒ»ãŠæ‚©ã¿å†…å®¹</label>
        <textarea id="content" maxlength="1000" rows="5"
          placeholder="ãŠå­ã•ã‚“ã®ã“ã¨ã€æ—¥ã€…ã®æ‚©ã¿ã€ä½•ã§ã‚‚æ°—è»½ã«æ›¸ã„ã¦ãã ã•ã„..."
          class="w-full p-3 border border-pink-200 rounded-lg focus:ring-2 focus:ring-pink-400 focus:border-transparent resize-none"></textarea>
        <p class="text-sm text-gray-500 mt-1"><span id="charCount">0</span>/1000</p>
      </div>

      <button onclick="submitPost()"
        class="w-full bg-gradient-to-r from-pink-400 to-rose-400 hover:from-pink-500 hover:to-rose-500 text-white font-medium py-3 px-6 rounded-lg transition-all flex items-center justify-center gap-2 shadow-md">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <line x1="22" y1="2" x2="11" y2="13"></line>
          <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
        </svg>
        æŠ•ç¨¿ã™ã‚‹
      </button>
    </div>

    <!-- Posts List -->
    <div id="postsList" class="space-y-4">
      <div class="bg-white rounded-2xl shadow-lg p-8 text-center text-gray-500">
        ã¾ã æŠ•ç¨¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚æœ€åˆã®æŠ•ç¨¿ã‚’ã—ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ
      </div>
    </div>
  </div>

  <script>
    const categories = {
      general: { label: 'æ—¥ã€…ã®æ‚©ã¿', color: 'bg-pink-100 text-pink-800' },
      health: { label: 'å¥åº·ãƒ»ç™ºé”', color: 'bg-rose-100 text-rose-800' },
      education: { label: 'å­¦ç¿’ãƒ»é€²è·¯', color: 'bg-purple-100 text-purple-800' },
      relationship: { label: 'è¦ªå­é–¢ä¿‚', color: 'bg-fuchsia-100 text-fuchsia-800' },
      lifestyle: { label: 'ç”Ÿæ´»ãƒ»ç¿’æ…£', color: 'bg-pink-100 text-pink-800' }
    };

    document.addEventListener('DOMContentLoaded', () => {
      const content = document.getElementById('content');
      content.addEventListener('input', () => {
        document.getElementById('charCount').textContent = content.value.length;
      });
      loadPosts();
    });

    function loadPosts() {
      const posts = [];
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key.startsWith('post:')) {
          const post = JSON.parse(localStorage.getItem(key));
          posts.push(post);
        }
      }
      posts.sort((a, b) => b.timestamp - a.timestamp);
      if (posts.length === 0) {
        document.getElementById('postsList').innerHTML =
          '<div class="bg-white rounded-2xl shadow-lg p-8 text-center text-gray-500">ã¾ã æŠ•ç¨¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚æœ€åˆã®æŠ•ç¨¿ã‚’ã—ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ</div>';
      } else {
        displayPosts(posts);
      }
    }

    function displayPosts(posts) {
      document.getElementById('postsList').innerHTML = posts.map(createPostHTML).join('');
    }

    function createPostHTML(post) {
      const category = categories[post.category];
      const likedPosts = JSON.parse(localStorage.getItem("likedPosts") || "[]");
      const isLiked = likedPosts.includes(post.id);

      const repliesHTML = post.replies.map(reply => `
        <div class="bg-pink-50 rounded-lg p-4 border border-pink-100">
          <p class="text-sm text-gray-800 mb-2">${escapeHtml(reply.text)}</p>
          <div class="flex items-center justify-between text-xs text-gray-600">
            <span class="font-medium text-pink-600">${escapeHtml(reply.nickname)}</span>
            <span>${formatTime(reply.timestamp)}</span>
          </div>
        </div>
      `).join('');

      return `
        <div class="bg-white rounded-2xl shadow-lg p-6 hover:shadow-xl transition-shadow border-l-4 border-pink-300">
          <div class="flex items-start justify-between mb-3">
            <span class="inline-block px-3 py-1 rounded-full text-xs font-medium ${category.color}">${category.label}</span>
            <span class="text-sm text-gray-500">${formatTime(post.timestamp)}</span>
          </div>

          <p class="text-gray-800 mb-3 whitespace-pre-wrap">${escapeHtml(post.content)}</p>

          <div class="flex items-center justify-between pt-3 border-t border-pink-100">
            <span class="text-sm text-pink-600 font-medium">${escapeHtml(post.nickname)}</span>
            <div class="flex items-center gap-4">
              <button onclick="likePost('${post.id}')" class="flex items-center gap-1 ${isLiked ? 'text-pink-600' : 'text-pink-400 hover:text-pink-500'} transition-colors">
                <svg class="w-5 h-5" fill="${isLiked ? 'currentColor' : 'none'}" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                </svg>
                <span class="text-sm font-medium">${post.likes}</span>
              </button>
              <button onclick="toggleReplyForm('${post.id}')" class="flex items-center gap-1 text-rose-500 hover:text-rose-600 transition-colors">
                ğŸ’¬ <span class="text-sm font-medium">${post.replies.length}</span>
              </button>
            </div>
          </div>

          <div class="mt-3 space-y-2">${repliesHTML}</div>

          <div id="replyForm-${post.id}" style="display: none;" class="mt-4 bg-pink-50 rounded-lg p-4 border border-pink-200">
            <h3 class="text-sm font-semibold text-pink-600 mb-3">è¿”ä¿¡ã‚’æ›¸ã</h3>
            <input id="replyNickname-${post.id}" type="text" maxlength="20"
              placeholder="ç©ºæ¬„ã®å ´åˆã¯ã€ŒåŒ¿åã®ä¿è­·è€…ã€ã¨è¡¨ç¤ºã•ã‚Œã¾ã™"
              class="w-full p-2 border border-pink-200 rounded-lg text-sm mb-2 focus:ring-2 focus:ring-pink-400 focus:border-transparent" />
            <textarea id="replyText-${post.id}" rows="3" maxlength="500"
              placeholder="åŠ±ã¾ã—ã‚„ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’æ›¸ã..."
              class="w-full p-2 border border-pink-200 rounded-lg text-sm focus:ring-2 focus:ring-pink-400 focus:border-transparent resize-none mb-2"></textarea>
            <div class="flex gap-2">
              <button onclick="submitReply('${post.id}')" class="bg-gradient-to-r from-pink-400 to-rose-400 text-white text-sm py-2 px-4 rounded-lg">è¿”ä¿¡ã™ã‚‹</button>
              <button onclick="toggleReplyForm('${post.id}')" class="bg-gray-200 text-gray-700 text-sm py-2 px-4 rounded-lg">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            </div>
          </div>
        </div>`;
    }

    function submitPost() {
      const content = document.getElementById('content').value.trim();
      const nickname = document.getElementById('nickname').value.trim();
      const category = document.getElementById('category').value;
      if (!content) {
        alert('ç›¸è«‡å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
      }

      const post = {
        id: Date.now().toString(),
        content,
        nickname: nickname || 'åŒ¿åã®ä¿è­·è€…',
        category,
        timestamp: Date.now(),
        likes: 0,
        replies: []
      };

      localStorage.setItem(`post:${post.id}`, JSON.stringify(post));
      document.getElementById('content').value = '';
      document.getElementById('nickname').value = '';
      document.getElementById('category').value = 'general';
      document.getElementById('charCount').textContent = '0';
      loadPosts();
      window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    }

    function likePost(postId) {
      const likedPosts = JSON.parse(localStorage.getItem("likedPosts") || "[]");
      if (likedPosts.includes(postId)) {
        alert("ã“ã®æŠ•ç¨¿ã«ã¯ã™ã§ã«ã„ã„ã­ã—ã¦ã„ã¾ã™ï¼");
        return;
      }

      const post = JSON.parse(localStorage.getItem(`post:${postId}`));
      post.likes += 1;
      localStorage.setItem(`post:${postId}`, JSON.stringify(post));

      likedPosts.push(postId);
      localStorage.setItem("likedPosts", JSON.stringify(likedPosts));

      loadPosts();
    }

    function toggleReplyForm(postId) {
      const form = document.getElementById(`replyForm-${postId}`);
      form.style.display = form.style.display === 'none' ? 'block' : 'none';
    }

    function submitReply(postId) {
      const replyText = document.getElementById(`replyText-${postId}`).value.trim();
      const replyNickname = document.getElementById(`replyNickname-${postId}`).value.trim();
      if (!replyText) {
        alert('è¿”ä¿¡å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
      }

      const post = JSON.parse(localStorage.getItem(`post:${postId}`));
      post.replies.push({
        id: Date.now().toString(),
        text: replyText,
        nickname: replyNickname || 'åŒ¿åã®ä¿è­·è€…',
        timestamp: Date.now()
      });
      localStorage.setItem(`post:${postId}`, JSON.stringify(post));
      loadPosts();
    }

    function formatTime(ts) {
      const diff = Date.now() - ts;
      const min = Math.floor(diff / 60000);
      const hr = Math.floor(diff / 3600000);
      const day = Math.floor(diff / 86400000);
      if (min < 1) return 'ãŸã£ãŸä»Š';
      if (min < 60) return `${min}åˆ†å‰`;
      if (hr < 24) return `${hr}æ™‚é–“å‰`;
      return `${day}æ—¥å‰`;
    }

    function escapeHtml(str) {
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }
  </script>
</body>
</html>